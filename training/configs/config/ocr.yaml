# OCR配置（Stage 6）
# ⚠️ 重要：相对路径相对于 /training/configs 目录

# OCR基础配置
ocr:
  # 是否启用OCR
  enabled: true

  # OCR引擎: paddleocr, easyocr, tesseract
  engine: "paddleocr"

  # 语言
  language: "en"  # en, ch, en+ch

  # 是否使用GPU
  use_gpu: true

  # GPU ID
  gpu_id: 0

# PaddleOCR配置
paddleocr:
  # 检测模型
  det_model_dir: null  # null表示使用默认模型

  # 识别模型
  rec_model_dir: null

  # 分类模型（用于判断文字方向）
  cls_model_dir: null

  # 是否使用角度分类器
  use_angle_cls: true

  # 语言
  lang: "en"

  # 是否显示日志
  show_log: false

  # 检测参数
  det_algorithm: "DB"  # DB, EAST, SAST
  det_limit_side_len: 960
  det_limit_type: "max"

  # 识别参数
  rec_algorithm: "CRNN"  # CRNN, Rosetta, STAR-Net
  rec_batch_num: 6

  # 后处理参数
  max_text_length: 25

  # 检测阈值
  det_db_thresh: 0.3
  det_db_box_thresh: 0.6
  det_db_unclip_ratio: 1.5

# EasyOCR配置
easyocr:
  # 支持的语言列表
  languages: ["en"]

  # 是否使用GPU
  gpu: true

  # 模型存储目录
  model_storage_directory: "../model/easyocr"

  # 检测参数
  decoder: "greedy"  # greedy, beamsearch
  beamWidth: 5
  batch_size: 1

  # 文本检测参数
  text_threshold: 0.7
  low_text: 0.4
  link_threshold: 0.4
  canvas_size: 2560
  mag_ratio: 1.0

# Tesseract配置
tesseract:
  # Tesseract路径
  tesseract_cmd: "tesseract"

  # 语言
  lang: "eng"

  # 配置选项
  config: "--psm 7"  # Page segmentation mode

  # OCR引擎模式
  oem: 3  # 0=Legacy, 1=LSTM, 2=Legacy+LSTM, 3=Default

# 注册号识别特定配置
registration:
  # 是否启用注册号专用模式
  specialized_mode: true

  # 注册号格式（正则表达式）
  # 例如：B-1234, N123AB, G-ABCD等
  patterns:
    - "^[A-Z]-[A-Z0-9]{4,6}$"  # 中国: B-1234
    - "^N[0-9]{1,5}[A-Z]{0,2}$"  # 美国: N123AB
    - "^[A-Z]-[A-Z]{4}$"  # 英国: G-ABCD
    - "^[A-Z]{2}-[A-Z]{3}$"  # 其他国家

  # 字符白名单（只识别这些字符）
  whitelist: "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-"

  # 最小置信度
  min_confidence: 0.6

  # 最大字符数
  max_characters: 10

  # 最小字符数
  min_characters: 4

# 预处理配置
preprocessing:
  # 是否启用预处理
  enabled: true

  # 灰度化
  grayscale: true

  # 二值化
  binarize:
    enabled: true
    method: "otsu"  # otsu, adaptive, threshold
    threshold: 127

  # 降噪
  denoise:
    enabled: true
    method: "bilateral"  # bilateral, gaussian, median
    kernel_size: 5

  # 锐化
  sharpen:
    enabled: true
    kernel: [[0, -1, 0], [-1, 5, -1], [0, -1, 0]]

  # 倾斜校正
  deskew:
    enabled: true

  # 对比度增强
  enhance_contrast:
    enabled: true
    method: "clahe"  # clahe, histogram_eq
    clip_limit: 2.0
    tile_grid_size: [8, 8]

  # 调整大小
  resize:
    enabled: true
    height: null  # null表示保持原始高度
    width: null
    scale_factor: 2.0  # 放大倍数

# 后处理配置
postprocessing:
  # 文本清理
  clean_text:
    enabled: true
    remove_spaces: true
    remove_special_chars: false
    uppercase: true

  # 格式验证
  validate_format:
    enabled: true
    use_regex: true

  # 置信度过滤
  confidence_filter:
    enabled: true
    min_confidence: 0.7

  # 长度过滤
  length_filter:
    enabled: true
    min_length: 4
    max_length: 10

# 检测区域配置
detection_area:
  # 是否使用YOLO预先检测注册号区域
  use_yolo: true

  # YOLO模型路径
  yolo_model: "../model/registration_detector.pt"

  # YOLO置信度阈值
  yolo_conf_threshold: 0.5

  # 是否裁剪检测区域
  crop_detected_area: true

  # 裁剪padding
  crop_padding: 0.1

# 输出配置
output:
  # 是否保存识别结果
  save_results: true

  # 保存路径
  save_path: "../data/registration/ocr_results.json"

  # 是否可视化
  visualize:
    enabled: false
    save_path: "../logs/ocr_visualization"
    draw_boxes: true
    draw_text: true

  # 是否返回详细信息
  return_details: true
  include_confidence: true
  include_bbox: true
  include_cropped_image: false

# 批处理配置
batch:
  # 批处理大小
  batch_size: 8

  # 工作线程数
  num_workers: 4

  # 是否使用多进程
  multiprocessing: false

# 性能优化
performance:
  # 是否缓存模型
  cache_model: true

  # 是否使用混合精度
  mixed_precision: false

  # 最大图片尺寸（超过则缩放）
  max_image_size: 4096
